<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Miryoku Layout for Silakka54 (Vial-Aligned)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        /* Mobile-first responsive design */
        .key {
            min-width: 3rem;
            min-height: 3rem;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }
        .key .text-xs {
            font-size: 0.95rem;
            line-height: 1.25;
        }
        
        /* Tablet and larger */
        @media (min-width: 768px) {
            .key {
                min-width: 3.75rem;
                min-height: 3.75rem;
                font-size: 1.05rem;
            }
            .key .text-xs {
                font-size: 1.05rem;
            }
        }
        
        /* Desktop */
        @media (min-width: 1024px) {
            .key {
                min-width: 4.25rem;
                min-height: 4.25rem;
                font-size: 1.15rem;
            }
            .key .text-xs {
                font-size: 1.15rem;
            }
        }
        
        .key:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        /* Dark mode overrides */
        .dark-mode {
            background-color: #0a0f1a;
            color: #e5e7eb;
        }
        .dark-mode.bg-gray-100 { background-color: #0a0f1a !important; }
        .dark-mode .bg-white { background-color: #0f172a !important; }
        .dark-mode .bg-gray-100 { background-color: #1f2937 !important; color: #e5e7eb !important; }
        .dark-mode .bg-gray-200 { background-color: #1f2937 !important; color: #e5e7eb !important; }
        .dark-mode .bg-gray-50 { background-color: #111827 !important; color: #e5e7eb !important; }
        .dark-mode .bg-blue-50 { background-color: #1d2a44 !important; color: #e5e7eb !important; }
        .dark-mode .bg-blue-100 { background-color: #223456 !important; color: #e5e7eb !important; }
        .dark-mode .tips-panel { background-color: #0b1324 !important; color: #f8fafc !important; }
        .dark-mode .tips-panel h5 { color: #ffffff !important; }
        .dark-mode .tips-panel ul li { color: #e0e7ff !important; }
        .dark-mode .bg-orange-100 { background-color: #fbbf24 !important; color: #0a1020 !important; }
        .dark-mode .bg-purple-100 { background-color: #d8b4fe !important; color: #170822 !important; }
        .dark-mode .bg-blue-100 { background-color: #bcd7ff !important; color: #0b1220 !important; }
        .dark-mode .bg-yellow-100 { background-color: #fef08a !important; color: #0b1220 !important; }
        .dark-mode .bg-green-200 { background-color: #34d399 !important; color: #052316 !important; }
        .dark-mode .thumb-key { box-shadow: 0 6px 14px rgba(52, 211, 153, 0.25); }
        .dark-mode .combo-key { border-color: #facc15 !important; }
        .dark-mode .key {
            box-shadow: 0 8px 18px -3px rgba(0, 0, 0, 0.45);
        }
        .dark-mode .key:hover {
            box-shadow: 0 10px 20px -4px rgba(0, 0, 0, 0.55);
        }
        .dark-mode .tooltip-text {
            background-color: #111827;
            color: #f9fafb;
        }
        .dark-mode .text-gray-900,
        .dark-mode .text-gray-800,
        .dark-mode .text-gray-600 { color: #cbd5e1 !important; }
        .dark-mode .text-gray-500 { color: #cbd5e1 !important; }
        .dark-mode .border-gray-200 { border-color: #1f2937 !important; }
        .dark-mode .border-gray-300 { border-color: #1f2937 !important; }
        .dark-mode .layer-btn { color: #f9fafb !important; box-shadow: 0 6px 14px rgba(0,0,0,0.35); }
        .dark-mode .layer-base { background-color: #4b5563 !important; color: #f9fafb !important; }
        .dark-mode .layer-media { background-color: #6b7280 !important; color: #f9fafb !important; }
        .dark-mode .layer-nav { background-color: #1d4ed8 !important; color: #f5f8ff !important; }
        .dark-mode .layer-mouse { background-color: #6d28d9 !important; color: #f7e9ff !important; }
        .dark-mode .layer-sym { background-color: #0369a1 !important; color: #e5f6ff !important; }
        .dark-mode .layer-num { background-color: #d97706 !important; color: #fff !important; }
        .dark-mode .layer-fun { background-color: #be185d !important; color: #ffe6f1 !important; }
        .dark-mode .layer-gaming { background-color: #4d7c0f !important; color: #f0ffe0 !important; }
        .dark-mode .layer-btn { color: #f9fafb !important; box-shadow: 0 6px 14px rgba(0,0,0,0.35); }
        .dark-mode .layer-base { background-color: #4b5563 !important; color: #f9fafb !important; }
        .dark-mode .layer-media { background-color: #b91c1c !important; color: #fdfdfd !important; }
        .dark-mode .layer-nav { background-color: #1d4ed8 !important; color: #f5f8ff !important; }
        .dark-mode .layer-mouse { background-color: #6d28d9 !important; color: #f7e9ff !important; }
        .dark-mode .layer-sym { background-color: #0369a1 !important; color: #e5f6ff !important; }
        .dark-mode .layer-num { background-color: #d97706 !important; color: #fff !important; }
        .dark-mode .layer-fun { background-color: #be185d !important; color: #ffe6f1 !important; }
        .dark-mode .layer-gaming { background-color: #4d7c0f !important; color: #f0ffe0 !important; }
        .dark-mode h1, .dark-mode h2, .dark-mode h3, .dark-mode h4 { color: #e5e7eb !important; }
        /* Thumb key palette to match layers */
        .thumb-esc { background-color: #bfdbfe !important; color: #0b1220 !important; }
        .thumb-media { background-color: #ef4444 !important; color: #fff !important; }
        .thumb-nav { background-color: #2563eb !important; color: #fff !important; }
        .thumb-mouse { background-color: #7c3aed !important; color: #fff !important; }
        .thumb-sym { background-color: #0284c7 !important; color: #fff !important; }
        .thumb-num { background-color: #d97706 !important; color: #fff !important; }
        .thumb-fun { background-color: #ec4899 !important; color: #fff !important; }
        .thumb-gaming { background-color: #4d7c0f !important; color: #fff !important; }
        .thumb-key .mod-label { color: #ffffff !important; }
        .thumb-esc .mod-label { color: #6b7280 !important; }
        
        .home-row {
            position: relative;
        }
        
        .combo-key {
            position: relative;
            border: 2px dashed #f59e0b;
        }
        
        .combo-key:hover {
            background-color: #fef3c7 !important;
        }
        
        .home-row::before {
            content: '';
            position: absolute;
            left: -8px;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 4px;
            background-color: #3b82f6;
            border-radius: 50%;
        }
        
        .thumb-key {
            min-width: 3rem;
        }
        
        @media (min-width: 768px) {
            .thumb-key {
                min-width: 4rem;
            }
        }
        
        @media (min-width: 1024px) {
            .thumb-key {
                min-width: 4.5rem;
            }
        }
        .layer-active {
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.9) inset, 0 0 0 1px rgba(0, 0, 0, 0.2);
            filter: brightness(1.05);
        }
        .layer-btn {
            color: #0b1019;
            box-shadow: 0 6px 16px rgba(0,0,0,0.18);
        }
        .layer-base { background-color: #9ca3af !important; color: #0b1019 !important; }
        .layer-media { background-color: #9ca3af !important; color: #0b1019 !important; }
        .layer-nav { background-color: #2563eb !important; color: #fff !important; }
        .layer-mouse { background-color: #7c3aed !important; color: #fff !important; }
        .layer-sym { background-color: #0ea5e9 !important; color: #05202e !important; }
        .layer-num { background-color: #f59e0b !important; color: #111827 !important; }
        .layer-fun { background-color: #ec4899 !important; color: #fff !important; }
        .layer-gaming { background-color: #84cc16 !important; color: #0f1a02 !important; }
        .key-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            line-height: 1.2;
        }
        .key-label.case-top {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 2px;
            height: 100%;
            padding: 10px 8px 18px 8px;
            text-align: center;
        }
        .key-label.case-top .case-label {
            font-size: 0.95rem;
            color: #4b5563;
            line-height: 1.15;
            opacity: 0.9;
        }
        .key-label.case-top .main-label {
            font-size: 1.12rem;
            line-height: 1.25;
        }
        .key-label.case-top .mod-label {
            position: absolute;
            bottom: 6px;
            left: 0;
            right: 0;
            margin-top: 0;
        }
        /* Special spacing for ; / Win key (R22) to improve readability */
        [data-key="R22"] .key-label.case-top {
            padding-top: 4px;
            padding-bottom: 26px;
            justify-content: flex-start;
        }
        [data-key="R22"] .key-label.case-top .mod-label {
            bottom: 4px;
            font-size: 0.9rem;
        }
        .mod-label {
            font-size: 0.82rem;
            color: #4b5563;
        }
        
        @media (min-width: 768px) {
            .mod-label {
                font-size: 0.92rem;
            }
        }
        
        @media (min-width: 1024px) {
            .mod-label {
                font-size: 1rem;
            }
        }
        .tooltip {
            position: relative;
            cursor: help;
        }
        .tooltip-text {
            visibility: hidden;
            opacity: 0;
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #1f2937;
            color: white;
            text-align: center;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 0.65rem;
            white-space: nowrap;
            z-index: 1000;
            transition: opacity 0.2s, visibility 0.2s;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            max-width: 200px;
        }
        
        @media (min-width: 768px) {
            .tooltip-text {
                padding: 8px 12px;
                font-size: 0.75rem;
                max-width: none;
            }
        }
        .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #1f2937 transparent transparent transparent;
        }
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gray-100 p-4 sm:p-6 lg:p-8">
	    <div id="app" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
	        <h1 class="text-3xl font-bold text-center mb-4">{{ config.title }}</h1>
	        <p class="text-center text-gray-600 mb-8">{{ config.subtitle }}</p>

	        <!-- Mode Selector -->
	        <div class="mb-8 text-center">
	            <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200 inline-block">
	                <p class="text-sm text-gray-600 mb-3 flex items-center justify-center gap-3">
	                    <span>Mode:</span>
	                    <button @click="toggleDarkMode" class="px-3 py-1 rounded border text-sm"
	                        :class="darkMode ? 'bg-slate-800 text-white border-slate-600' : 'bg-gray-200 text-gray-800 border-gray-300'">
	                        {{ darkMode ? 'Dark Mode' : 'Light Mode' }}
	                    </button>
	                </p>
	                <div class="flex justify-center gap-2 flex-wrap">
	                    <span v-if="mode === 'macos'" class="px-3 py-2 bg-blue-600 text-white rounded text-sm">
	                        Current: MacOS Mode
	                    </span>
	                    <a v-else href="./" class="px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors text-sm">
	                        MacOS Mode
	                    </a>

	                    <span v-if="mode === 'windows'" class="px-3 py-2 bg-slate-700 text-white rounded text-sm">
	                        Current: Windows Mode
	                    </span>
	                    <a v-else href="./?mode=windows" class="px-3 py-2 bg-slate-700 text-white rounded hover:bg-slate-800 transition-colors text-sm">
	                        Windows Mode
	                    </a>
	                </div>
	            </div>
	        </div>
	        
	        <!-- Layer Selector -->
	        <div class="flex flex-wrap justify-center gap-2 mb-8">
            <button 
                v-for="layer in config.layers" 
                :key="layer.id"
                @click="showLayer(layer.id)" 
                :class="['layer-btn px-4 py-2 rounded', 'layer-' + layer.id, currentLayer === layer.id ? 'layer-active' : '']"
            >
                {{ layer.name }}
            </button>
        </div>

        <!-- Keyboard Layout -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-8 mb-8">
            <!-- Left Half -->
            <div class="bg-white p-3 sm:p-4 md:p-6 rounded-lg shadow-lg">
                <h3 class="text-center font-semibold mb-4">Left Half</h3>
                <div class="grid grid-cols-6 gap-1 sm:gap-1.5">
                    <!-- Render left keys by rows -->
                    <template v-for="row in 4" :key="'left-row-' + row">
                        <div 
                            v-for="key in getKeysForRow('left', row - 1)" 
                            :key="key.id"
                            :class="getKeyClasses(key)"
                            :data-key="key.id"
                            v-html="getKeyContent(key.id)"
                        ></div>
                    </template>
                </div>
                
                <!-- Left Thumb Cluster -->
                <div class="flex justify-center gap-2 mt-4">
                    <div 
                        v-for="thumbKey in config.keyboardLayout.leftThumbKeys" 
                        :key="thumbKey.id"
                        :class="getKeyClasses(thumbKey)"
                        :data-key="thumbKey.id"
                        v-html="getKeyContent(thumbKey.id)"
                    ></div>
                </div>
            </div>

            <!-- Right Half -->
            <div class="bg-white p-3 sm:p-4 md:p-6 rounded-lg shadow-lg">
                <h3 class="text-center font-semibold mb-4">Right Half</h3>
                <div class="grid grid-cols-6 gap-1 sm:gap-1.5">
                    <!-- Render right keys by rows -->
                    <template v-for="row in 4" :key="'right-row-' + row">
                        <div 
                            v-for="key in getKeysForRow('right', row - 1)" 
                            :key="key.id"
                            :class="getKeyClasses(key)"
                            :data-key="key.id"
                            v-html="getKeyContent(key.id)"
                        ></div>
                    </template>
                </div>
                
                <!-- Right Thumb Cluster -->
                <div class="flex justify-center gap-2 mt-4">
                    <div 
                        v-for="thumbKey in config.keyboardLayout.rightThumbKeys" 
                        :key="thumbKey.id"
                        :class="getKeyClasses(thumbKey)"
                        :data-key="thumbKey.id"
                        v-html="getKeyContent(thumbKey.id)"
                    ></div>
                </div>
            </div>
        </div>

        <!-- Combo Reference -->
        <div class="mt-8 bg-white p-4 rounded-lg shadow">
            <div class="flex items-center justify-between mb-4">
                <h3 class="font-semibold">Combo Reference (Vial Configuration)</h3>
                <button 
                    @click="showCombos = !showCombos" 
                    class="px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600 transition-colors"
                >
                    {{ showCombos ? 'Hide' : 'Show' }} Combos
                </button>
            </div>
            
            <div v-show="showCombos" class="transition-all duration-300">
                <div class="grid md:grid-cols-2 gap-6">
                    <!-- Essential Combos -->
                    <div>
                        <h4 class="font-medium mb-3 text-blue-700">Essential Navigation</h4>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                                <span class="font-mono bg-yellow-100 px-2 py-1 rounded">Q + W</span>
                                <span class="text-gray-600">‚Üí</span>
                                <span>Escape</span>
                            </div>
                            <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                                <span class="font-mono bg-yellow-100 px-2 py-1 rounded">U + I</span>
                                <span class="text-gray-600">‚Üí</span>
                                <span>Escape</span>
                            </div>
	                            <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
	                                <span class="font-mono bg-yellow-100 px-2 py-1 rounded">W + E</span>
	                                <span class="text-gray-600">‚Üí</span>
	                                <span>{{ modifierComboName }}</span>
	                            </div>
                        </div>
                    </div>

                    <!-- Text Editing Combos -->
                    <div>
                        <h4 class="font-medium mb-3 text-green-700">Text Editing</h4>
                        <div class="space-y-2 text-sm">
	                            <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
	                                <span class="font-mono bg-yellow-100 px-2 py-1 rounded">X + C</span>
	                                <span class="text-gray-600">‚Üí</span>
	                                <span>Cut ({{ shortcutKeyName }}+X)</span>
	                            </div>
	                            <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
	                                <span class="font-mono bg-yellow-100 px-2 py-1 rounded">C + V</span>
	                                <span class="text-gray-600">‚Üí</span>
	                                <span>Copy ({{ shortcutKeyName }}+C)</span>
	                            </div>
                            <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                                <span class="font-mono bg-yellow-100 px-2 py-1 rounded">I + O</span>
                                <span class="text-gray-600">‚Üí</span>
                                <span>Quote (')</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Advanced Combos -->
                <div class="mt-6">
                    <h4 class="font-medium mb-3 text-purple-700">Advanced Combos</h4>
	                    <div class="grid md:grid-cols-2 gap-4 text-sm">
	                        <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
	                            <span class="font-mono bg-yellow-100 px-2 py-1 rounded">Q + W + E</span>
	                            <span class="text-gray-600">‚Üí</span>
	                            <span>Quit App ({{ shortcutKeyName }}+Q)</span>
	                        </div>
                        <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                            <span class="font-mono bg-yellow-100 px-2 py-1 rounded">, + .</span>
                            <span class="text-gray-600">‚Üí</span>
                            <span>MEH (Alt+Ctrl+Shift+GUI)</span>
                        </div>
                    </div>
                </div>

                <!-- Usage Tips -->
                <div class="mt-6 p-3 bg-blue-50 rounded-lg tips-panel">
                    <h5 class="font-medium text-blue-800 mb-2">üí° Combo Tips for Small Hands</h5>
		                <ul class="text-sm text-blue-700 space-y-1">
		                    <li>‚Ä¢ Press keys simultaneously - no need to hold and press</li>
		                    <li>‚Ä¢ Q+W is easier than reaching for Escape key</li>
		                    <li>‚Ä¢ X+C and C+V combos are faster than {{ shortcutKeyName }}+X/C shortcuts</li>
		                    <li>‚Ä¢ All combos use adjacent or nearby keys for comfort</li>
		                    <li>‚Ä¢ Yellow highlighted keys show which keys have combos</li>
		                </ul>
                </div>
            </div>
        </div>

        <!-- Legend -->
        <div class="mt-8 bg-white p-4 rounded-lg shadow">
            <h3 class="font-semibold mb-3">Key Features of This Layout</h3>
            <div class="grid grid-cols-2 gap-4 text-sm">
                <div>
                    <h4 class="font-medium mb-2">Color Legend:</h4>
                    <div class="space-y-1">
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4 bg-blue-100 rounded"></div>
                            <span>Home row with modifiers (GUI/Alt/Ctrl/Shift)</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4 bg-orange-100 rounded"></div>
                            <span>Number row with direct symbol access</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4 bg-purple-100 rounded"></div>
                            <span>Common symbols and extra keys</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4 bg-green-200 rounded"></div>
                            <span>Thumb keys (Space/Enter/Tab/Layer switches)</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4 bg-yellow-100 border-2 border-dashed border-yellow-600 rounded"></div>
                            <span>Combo keys (see Combo Reference above)</span>
                        </div>
                    </div>
                </div>
                <div>
                    <h4 class="font-medium mb-2">Layout Benefits:</h4>
                    <ul class="space-y-1 text-gray-600">
                        <li>‚Ä¢ Direct access to numbers and symbols</li>
                        <li>‚Ä¢ Common punctuation readily available</li>
                        <li>‚Ä¢ Home row modifiers for ergonomics</li>
                        <li>‚Ä¢ Minimal layer switching needed</li>
                        <li>‚Ä¢ Preserves Miryoku core principles</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- How to Change Layers -->
        <div class="mt-8 bg-blue-50 p-6 rounded-lg border border-blue-200">
            <h3 class="font-semibold text-blue-900 mb-4 text-center">How to Change Between Layers</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Physical Keyboard Usage -->
                <div class="bg-white p-4 rounded-lg shadow-sm">
                    <h4 class="font-medium text-blue-800 mb-3 flex items-center">
                        <span class="bg-blue-100 rounded-full w-6 h-6 flex items-center justify-center text-xs mr-2">1</span>
                        On Your Physical Keyboard
                    </h4>
                    <div class="space-y-2 text-sm">
                        <div class="flex items-start gap-2">
                            <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-medium">Hold</span>
                            <div>
                                <strong>Esc key (left thumb)</strong> ‚Üí Media layer (volume, RGB controls)
                                <div class="text-gray-600 text-xs">Right hand becomes media controls</div>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-medium">Hold</span>
                            <div>
                                <strong>Space key (left thumb)</strong> ‚Üí Navigation layer (arrows, clipboard)
                                <div class="text-gray-600 text-xs">Right hand becomes navigation controls</div>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-medium">Hold</span>
                            <div>
                                <strong>Tab key (left thumb)</strong> ‚Üí Mouse layer (mouse movement and clicks)
                                <div class="text-gray-600 text-xs">Right hand becomes mouse controls</div>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-medium">Hold</span>
                            <div>
                                <strong>Enter key (right thumb)</strong> ‚Üí Symbols layer (punctuation)
                                <div class="text-gray-600 text-xs">Left hand becomes symbol controls</div>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-medium">Hold</span>
                            <div>
                                <strong>Backspace key (right thumb)</strong> ‚Üí Numbers layer (numpad)
                                <div class="text-gray-600 text-xs">Left hand becomes number controls</div>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-medium">Hold</span>
                            <div>
                                <strong>Delete key (right thumb)</strong> ‚Üí Function layer (F-keys)
                                <div class="text-gray-600 text-xs">Left hand becomes function key controls</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Visualizer Usage -->
                <div class="bg-white p-4 rounded-lg shadow-sm">
                    <h4 class="font-medium text-blue-800 mb-3 flex items-center">
                        <span class="bg-blue-100 rounded-full w-6 h-6 flex items-center justify-center text-xs mr-2">2</span>
                        In This Visualizer
                    </h4>
                    <div class="space-y-2 text-sm">
                        <div class="flex items-start gap-2">
                            <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-medium">Click</span>
                            <div>
                                <strong>Layer buttons above</strong> ‚Üí Switch views
                                <div class="text-gray-600 text-xs">See what each layer looks like</div>
                            </div>
                        </div>
                        <div class="flex items-start gap-2">
                            <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded text-xs font-medium">Hover</span>
                            <div>
                                <strong>Over any key</strong> ‚Üí See details
                                <div class="text-gray-600 text-xs">Keys lift up to show they're interactive</div>
                            </div>
                        </div>
                        <div class="text-gray-600 text-xs mt-3 p-2 bg-gray-50 rounded">
                            üí° <strong>Tip:</strong> The visualizer shows the final result - on your keyboard, you hold thumb keys to temporarily access other layers while typing
                        </div>
                    </div>
                </div>
            </div>

            <!-- Key Principle -->
            <div class="mt-4 p-3 bg-blue-100 rounded-lg text-center">
                <p class="text-sm text-blue-800">
                    <strong>Key Principle:</strong> Tap thumb keys for their primary function (Space, Enter, etc.) ‚Ä¢ 
                    Hold thumb keys to activate layers on the opposite hand
                </p>
            </div>
        </div>

	        <!-- Quick Tips -->
		        <div class="mt-4 text-center text-gray-600">
		            <p class="font-medium">Quick Reference:</p>
		            <p class="text-sm mt-1">{{ homeRowModsText }}</p>
		        </div>

        <!-- Footer -->
        <div class="mt-8 pt-8 border-t border-gray-300 text-center">
            <p class="text-xs text-gray-500">
                <a href="https://github.com/manna-harbour/miryoku" class="text-blue-500 hover:underline" target="_blank" rel="noopener">Miryoku Layout</a> by manna-harbour ‚Ä¢ 
                <a href="https://github.com/Squalius-cephalus/silakka54" class="text-blue-500 hover:underline" target="_blank" rel="noopener">Silakka54</a> keyboard ‚Ä¢ 
                <a href="https://getreuer.info/posts/keyboards/alt-layouts/index.html#which-alt-keyboard-layout-should-i-learn" class="text-blue-500 hover:underline" target="_blank" rel="noopener">Alt Layout Guide</a><br>
                Built with <a href="https://claude.ai/code" class="text-blue-500 hover:underline" target="_blank" rel="noopener">Claude Code</a> by <a href="http://itman.fyi/" class="text-blue-500 hover:underline" target="_blank" rel="noopener">itman.fyi</a>
            </p>
        </div>
    </div>

	    <script>
	        const { createApp } = Vue;
	        const getModeFromLocation = () => {
	            const params = new URLSearchParams(window.location.search);
	            const mode = params.get('mode');
	            if (mode === 'windows') return 'windows';
	            if (mode === 'macos') return 'macos';

	            // Backward compatibility with older links
	            const variant = params.get('variant');
	            if (variant === 'windows') return 'windows';

	            return 'macos';
	        };
	        
	        createApp({
	            data() {
	                const mode = getModeFromLocation();
	                return {
	                    config: {
	                        title: 'Loading...',
	                        subtitle: 'Loading keyboard layout...',
	                        layers: [],
                        keyboardLayout: {
                            leftKeys: [],
                            rightKeys: [],
                            leftThumbKeys: [],
                            rightThumbKeys: []
                        },
	                        tooltips: {},
	                        layerData: {}
                    },
                    currentLayer: 'base',
                    showCombos: false,
                    mode,
                    rawConfig: null,
                    darkMode: false
                }
            },
            async mounted() {
                this.initializeTheme();
                await this.loadConfig();
                this.updateTooltips();
            },
	            computed: {
	                shortcutKeyName() {
	                    return this.mode === 'windows' ? 'Ctrl' : 'Cmd';
	                },
	                modifierComboName() {
	                    return this.mode === 'windows' ? 'Win modifier' : 'Cmd modifier';
	                },
	                homeRowModsText() {
	                    if (this.mode === 'windows') {
	                        return 'Home row modifiers: Win (pinky) | Alt (ring) | Ctrl (middle) | Shift (index)';
	                    }
	                    return 'Home row modifiers: Cmd (pinky) | Opt (ring) | Ctrl (middle) | Shift (index)';
                }
            },
            methods: {
                initializeTheme() {
                    const saved = localStorage.getItem('theme');
                    if (saved === 'dark') this.darkMode = true;
                    if (saved === 'light') this.darkMode = false;
                    this.applyTheme();
                },
                applyTheme() {
                    if (this.darkMode) {
                        document.body.classList.add('dark-mode');
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.body.classList.remove('dark-mode');
                        localStorage.setItem('theme', 'light');
                    }
                },
                toggleDarkMode() {
                    this.darkMode = !this.darkMode;
                    this.applyTheme();
                },
                deepClone(obj) {
                    return JSON.parse(JSON.stringify(obj));
                },
	                mapModeText(text) {
	                    if (typeof text !== 'string') return text;

	                    if (this.mode === 'windows') {
	                        return text
	                            .replace(/\bCmd\+/g, 'Ctrl+')
	                            .replace(/\bGUI\b/g, 'Win')
	                            .replace(/\bAlt\b/g, 'Alt')
	                            .replace(/Ctrl‚ÜîGUI/g, 'Ctrl‚ÜîWin');
	                    }

	                    // macOS mode
	                    return text
	                        .replace(/\bGUI\b/g, 'Cmd')
	                        .replace(/\bAlt\b/g, 'Opt')
	                        .replace(/Ctrl‚ÜîGUI/g, 'Ctrl‚ÜîCmd');
	                },
	                mapStrings(value) {
	                    if (typeof value === 'string') return this.mapModeText(value);
	                    if (Array.isArray(value)) return value.map((v) => this.mapStrings(v));
	                    if (value && typeof value === 'object') {
	                        const out = {};
	                        for (const [k, v] of Object.entries(value)) out[k] = this.mapStrings(v);
	                        return out;
	                    }
	                    return value;
	                },
	                applyModeToConfig(rawConfig) {
	                    const config = this.deepClone(rawConfig);

	                    config.title = this.mode === 'windows'
	                        ? 'Miryoku Layout for Silakka54 (Windows Mode)'
	                        : 'Miryoku Layout for Silakka54 (MacOS Mode)';
	                    config.subtitle = this.mode === 'windows'
	                        ? 'QWERTY Miryoku-style HRMs, combos, OS toggle, and layers (Windows labels)'
	                        : 'QWERTY Miryoku-style HRMs, combos, OS toggle, and layers (macOS labels)';

	                    config.layerData = this.mapStrings(config.layerData || {});
	                    config.tooltips = this.mapStrings(config.tooltips || {});

	                    // Hide gaming layer in MacOS Mode (it‚Äôs a Windows-specific layer)
	                    if (this.mode !== 'windows') {
	                        // Remove the base-layer gaming entry hint to keep this a MacOS cheat sheet
	                        if (config.layerData?.base?.R11) {
	                            config.layerData.base.R11 = '<div class="key-label">=<br><span class="mod-label">+</span></div>';
	                        }
	                        if (config.tooltips?.R11) {
	                            config.tooltips.R11 = 'Equals key | Tap: =/+';
	                        }

	                        if (Array.isArray(config.layers)) {
	                            config.layers = config.layers.filter((l) => l.id !== 'gaming');
	                        }
	                        if (config.layerData) {
	                            delete config.layerData.gaming;
	                        }
	                        if (this.currentLayer === 'gaming') {
	                            this.currentLayer = 'base';
	                        }
	                    }

	                    return config;
	                },
	                async loadConfig() {
	                    try {
	                        this.mode = getModeFromLocation();
	                        const response = await fetch('./app.json');
	                        this.rawConfig = await response.json();
	                        this.config = this.applyModeToConfig(this.rawConfig);

	                        const defaultLayer = this.config.layers.find((l) => l.active)?.id || 'base';
	                        this.currentLayer = this.config.layers.some((l) => l.id === this.currentLayer)
	                            ? this.currentLayer
	                            : defaultLayer;

	                        // Update page title for quick-cheat-sheet usage
	                        document.title = this.config.title;
	                    } catch (error) {
	                        console.error('Failed to load config:', error);
	                        // Fallback config
	                        this.config = {
	                            title: 'Miryoku Layout for Silakka54',
	                            subtitle: 'QWERTY Miryoku-style HRMs (fallback)',
	                            layers: [
	                                {id: 'base', name: 'Base', active: true}
	                            ],
	                            keyboardLayout: { leftKeys: [], rightKeys: [], leftThumbKeys: [], rightThumbKeys: [] },
                            tooltips: {},
                            layerData: { base: {} }
                        };
                    }
                },
                showLayer(layerId) {
                    this.currentLayer = layerId;
                    this.$nextTick(() => {
                        this.updateTooltips();
                    });
                },
                getKeysForRow(side, row) {
                    if (!this.config.keyboardLayout) return [];
                    const keys = side === 'left' ? this.config.keyboardLayout.leftKeys : this.config.keyboardLayout.rightKeys;
                    return keys ? keys.filter(key => key.row === row) : [];
                },
	                getKeyClasses(key) {
	                    let classes = ['key', 'rounded', 'flex', 'items-center', 'justify-center', 'tooltip'];
	                    
	                    // Add base classes from config
	                    if (key.class) {
	                        const currentLayer = this.currentLayer;
	                        const tokens = key.class.split(' ');
	                        const isComboKey = tokens.includes('combo-key');
	                        const isHomeRow = tokens.includes('home-row');

	                        const baseClasses = tokens
	                            .filter(cls => cls !== 'combo-key')
	                            .filter(cls => !(currentLayer === 'gaming' && cls === 'home-row'))
	                            .filter(cls => !(currentLayer === 'gaming' && cls === 'bg-blue-100'))
	                            .filter(cls => !((currentLayer !== 'base') && cls === 'bg-yellow-100'));

	                        // Gaming layer is plain (no HRM coloring)
	                        if (currentLayer === 'gaming' && isHomeRow) {
	                            baseClasses.push('bg-gray-100');
	                        }

	                        // Combos are only active on base (remove highlight elsewhere)
	                        if (currentLayer !== 'base' && isComboKey) {
	                            baseClasses.push('bg-gray-100');
	                        }
	                        classes = classes.concat(baseClasses);
	                    }
	                    
	                    // Only add combo-key class if we're on the base layer
	                    if (this.currentLayer === 'base' && key.class && key.class.includes('combo-key')) {
	                        classes.push('combo-key');
	                    }
	                    
	                    return classes;
	                },
                getKeyContent(keyId) {
                    if (!this.config.layerData) return '';
                    const layerData = this.config.layerData[this.currentLayer];
                    if (!layerData) return '';
                    
                    const keyValue = layerData[keyId] || '';
                    const tooltipText = this.getTooltipText(keyId, keyValue);
                    
                    if (tooltipText) {
                        return `<span class="text-xs font-medium">${keyValue}</span>
                                <div class="tooltip-text">${tooltipText}</div>`;
                    } else {
                        return `<span class="text-xs font-medium">${keyValue}</span>`;
                    }
                },
	                getTooltipText(keyId, keyValue) {
                    // Only show combo-specific tooltips on base layer
                    if (this.currentLayer === 'base' && this.config.tooltips && this.config.tooltips[keyId]) {
                        return this.config.tooltips[keyId];
                    } 
                    // For non-base layers, show generic descriptions
                    else if (keyValue === '' || keyValue === '___') {
                        return keyValue === '___' ? 'Layer key being held' : 'No function on this layer';
                    } else {
                        // Generic tooltip for regular keys
	                        const keyDescriptions = {
                            '‚Üê': 'Left arrow key',
                            '‚Üí': 'Right arrow key', 
                            '‚Üë': 'Up arrow key',
                            '‚Üì': 'Down arrow key',
                            'PgUp': 'Page Up key',
                            'PgDn': 'Page Down key',
	                            'Bksp': 'Backspace key',
	                            'GUI': 'GUI/Super modifier',
	                            'Win': 'Windows modifier',
	                            'Cmd': 'Command (‚åò) modifier',
	                            'Opt': 'Option (‚å•) modifier',
	                            'Alt': 'Alt modifier',
	                            'Ctrl': 'Control modifier', 
	                            'Shift': 'Shift modifier',
                            'Cut': 'Cut to clipboard (Ctrl+X)',
                            'Copy': 'Copy to clipboard (Ctrl+C)',
                            'Paste': 'Paste from clipboard (Ctrl+V)',
                            'Undo': 'Undo last action (Ctrl+Z)',
                            'Redo': 'Redo last action (Ctrl+Y)',
                            'M‚Üê': 'Mouse movement: Left',
                            'M‚Üì': 'Mouse movement: Down',
                            'M‚Üë': 'Mouse movement: Up',
                            'M‚Üí': 'Mouse movement: Right',
                            'LClick': 'Mouse: Left click',
                            'MClick': 'Mouse: Middle click (wheel)',
                            'RClick': 'Mouse: Right click',
                            'WhlL': 'Mouse wheel: Left',
                            'WhlD': 'Mouse wheel: Down',
                            'WhlU': 'Mouse wheel: Up',
                            'WhlR': 'Mouse wheel: Right'
                        };
                        return keyDescriptions[keyValue] || `${keyValue} key`;
                    }
                },
                updateTooltips() {
                    // Vue handles this automatically through reactivity
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
